<?xml version='1.0' encoding='utf-8'?>
<!-- Duck Biped: position-controlled joints for passive standing stability
     Design: low CoM, wide stance, short stocky legs, box feet
     Philosophy: position actuators provide "stiff tendons" that hold the robot
     upright passively. The RL policy outputs target joint angles, not raw torques.
     This dramatically simplifies the learning problem (don't need to learn balance
     before learning to walk). -->
<mujoco model="DuckBiped">
  <compiler angle="radian" inertiafromgeom="true" />

  <default>
    <joint limited="true" damping="2.0" armature="0.01" />
    <geom contype="1" conaffinity="1" condim="3" density="1000"
          friction="0.8 0.1 0.1" />
    <position ctrlrange="-1 1" kp="40" />
  </default>

  <worldbody>
    <!--
      Leg geometry: feet rest ON floor at z=0.
      Base z=0.22 → hip z=0.17 → knee z=0.09 → ankle z=0.03
      Foot box at pos=(0,-0.01,-0.015), size=(0.05,0.06,0.015)
      Foot bottom at z = 0.03 - 0.015 - 0.015 = 0.00 (on floor)
      Foot contact area: 10cm wide (X) x 12cm long (Y) per foot
      Support polygon: ~38cm wide (hips at ±14cm + foot half-width 5cm)
    -->
    <body name="base" pos="0 0 0.22">
      <freejoint name="root" />
      <!-- Wide, flat, heavy egg body (duck proportions) -->
      <geom name="torso" type="ellipsoid" size="0.16 0.14 0.08"
            rgba="0.9 0.7 0.3 1.0" mass="10.0" />

      <!-- IMU site for sensors -->
      <site name="imu" pos="0 0 0" />

      <!-- Forward-facing camera (looks in -Y = forward) -->
      <camera name="camera_1_cam" fovy="90.0"
              pos="0 -0.15 0.04" euler="-1.5707963 0 3.14159265" />

      <!-- === LEFT LEG === -->
      <body name="left_upper_leg" pos="-0.14 0 -0.05">
        <joint name="left_hip_abd" type="hinge" axis="0 1 0"
               pos="0 0 0" range="-0.4 0.4" damping="1.0" />
        <joint name="left_hip" type="hinge" axis="1 0 0"
               pos="0 0 0" range="-1.0 0.5" damping="3.0" />
        <geom name="left_upper_leg" type="capsule" fromto="0 0 0 0 0 -0.08"
              size="0.04" rgba="0.85 0.65 0.25 1.0" />

        <body name="left_lower_leg" pos="0 0 -0.08">
          <joint name="left_knee" type="hinge" axis="1 0 0"
                 pos="0 0 0" range="0 1.2" damping="2.0" />
          <geom name="left_lower_leg" type="capsule" fromto="0 0 0 0 0 -0.06"
                size="0.035" rgba="0.85 0.65 0.25 1.0" />

          <body name="left_foot" pos="0 0 -0.06">
            <joint name="left_ankle" type="hinge" axis="1 0 0"
                   pos="0 0 0" range="-0.4 0.4" damping="1.5" />
            <!-- Box foot: flat bottom for area contact, provides lateral stability -->
            <geom name="left_foot" type="box"
                  size="0.05 0.06 0.015"
                  pos="0 -0.01 -0.015"
                  rgba="1.0 0.6 0.1 1.0"
                  friction="1.2 0.3 0.1" mass="0.4" />
          </body>
        </body>
      </body>

      <!-- === RIGHT LEG === -->
      <body name="right_upper_leg" pos="0.14 0 -0.05">
        <joint name="right_hip_abd" type="hinge" axis="0 1 0"
               pos="0 0 0" range="-0.4 0.4" damping="1.0" />
        <joint name="right_hip" type="hinge" axis="1 0 0"
               pos="0 0 0" range="-1.0 0.5" damping="3.0" />
        <geom name="right_upper_leg" type="capsule" fromto="0 0 0 0 0 -0.08"
              size="0.04" rgba="0.85 0.65 0.25 1.0" />

        <body name="right_lower_leg" pos="0 0 -0.08">
          <joint name="right_knee" type="hinge" axis="1 0 0"
                 pos="0 0 0" range="0 1.2" damping="2.0" />
          <geom name="right_lower_leg" type="capsule" fromto="0 0 0 0 0 -0.06"
                size="0.035" rgba="0.85 0.65 0.25 1.0" />

          <body name="right_foot" pos="0 0 -0.06">
            <joint name="right_ankle" type="hinge" axis="1 0 0"
                   pos="0 0 0" range="-0.4 0.4" damping="1.5" />
            <!-- Box foot: flat bottom for area contact, provides lateral stability -->
            <geom name="right_foot" type="box"
                  size="0.05 0.06 0.015"
                  pos="0 -0.01 -0.015"
                  rgba="1.0 0.6 0.1 1.0"
                  friction="1.2 0.3 0.1" mass="0.4" />
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <contact>
    <exclude body1="base" body2="left_upper_leg" />
    <exclude body1="base" body2="right_upper_leg" />
    <exclude body1="left_upper_leg" body2="left_lower_leg" />
    <exclude body1="left_lower_leg" body2="left_foot" />
    <exclude body1="right_upper_leg" body2="right_lower_leg" />
    <exclude body1="right_lower_leg" body2="right_foot" />
    <exclude body1="left_upper_leg" body2="right_upper_leg" />
  </contact>

  <actuator>
    <!-- Position actuators: ctrl=0 holds joints at default angle (standing)
         kp=40 default, reduced from 100 to match smaller/lighter duck body -->
    <position name="left_hip_abd_motor" joint="left_hip_abd" kp="25" />
    <position name="left_hip_motor" joint="left_hip" />
    <position name="left_knee_motor" joint="left_knee" />
    <position name="left_ankle_motor" joint="left_ankle" kp="30" />
    <position name="right_hip_abd_motor" joint="right_hip_abd" kp="25" />
    <position name="right_hip_motor" joint="right_hip" />
    <position name="right_knee_motor" joint="right_knee" />
    <position name="right_ankle_motor" joint="right_ankle" kp="30" />
  </actuator>

  <sensor>
    <jointpos name="left_hip_abd_pos" joint="left_hip_abd" />
    <jointpos name="left_hip_pos" joint="left_hip" />
    <jointpos name="left_knee_pos" joint="left_knee" />
    <jointpos name="left_ankle_pos" joint="left_ankle" />
    <jointpos name="right_hip_abd_pos" joint="right_hip_abd" />
    <jointpos name="right_hip_pos" joint="right_hip" />
    <jointpos name="right_knee_pos" joint="right_knee" />
    <jointpos name="right_ankle_pos" joint="right_ankle" />
    <jointvel name="left_hip_abd_vel" joint="left_hip_abd" />
    <jointvel name="left_hip_vel" joint="left_hip" />
    <jointvel name="left_knee_vel" joint="left_knee" />
    <jointvel name="left_ankle_vel" joint="left_ankle" />
    <jointvel name="right_hip_abd_vel" joint="right_hip_abd" />
    <jointvel name="right_hip_vel" joint="right_hip" />
    <jointvel name="right_knee_vel" joint="right_knee" />
    <jointvel name="right_ankle_vel" joint="right_ankle" />
    <gyro name="torso_gyro" site="imu" />
    <accelerometer name="torso_accel" site="imu" />
  </sensor>
</mujoco>
